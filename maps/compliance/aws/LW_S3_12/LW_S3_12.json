{"configurations":[{"_id":"605890bf257f080034066fa2","name":"LaceworkConfig","value":"{\n    \"name\": \"LaceworkConfiguration\",\n    \"policyID\": \"LW_S3_12\",\n    \"violationdescription\": \"Ensure the S3 bucket requires MFA to delete objects\",\n    \"eventuuid\": \"6ec701d8-5bd5-47a2-afa4-134e6abb038b\",\n    \"mfadevice\": \"SERIAL 123456\",\n    \"dotheremediationviacli\": \"false\",\n    \"dotheremediationviaobject\": \"false\",\n    \"sendslackmessagesforignored\": \"true\",\n    \"bucketIgnoreList\":[\n        \"arn:aws:s3:::mybucket01\",\n        \"arn:aws:s3:::mybucket02\",\n        \"arn:aws:s3:::mybucket03\"\n    ]\n}","mapRevision":"605890bf257f080034066f85","__v":0}],"processes":[{"flowControl":"each","actionsExecution":"series","correlateAgents":null,"mandatory":null,"actions":[{"retries":0,"mandatory":null,"isEnabled":true,"params":[{"_id":"605890bf257f080034066f88","code":true,"value":"geteventid()","param":"6036a2b907d26400341da5cd","name":"EVENT_ID"}],"name":"geteventid","timeout":null,"method":"GetEventDetails","numParallel":null}],"used_plugin":{"name":"lacework","version":"1.0.0"},"uuid":"6ec701d8-5bd5-47a2-afa4-134e6abb038b","numProcessParallel":null,"name":"Get event details","description":null,"condition":"checkconfiguration()","coordination":null,"filterAgents":null,"postRun":"createBucketList() ","preRun":null},{"flowControl":"each","actionsExecution":"series","correlateAgents":null,"mandatory":null,"actions":[{"name":"printBucketName","timeout":null,"retries":0,"method":"execute","mandatory":null,"params":[{"code":true,"value":"printBucketName()","param":null,"viewName":"command","name":"COMMANDS","type":"string","description":null}],"isEnabled":true,"numParallel":null},{"name":"remediateviaawscli","timeout":null,"retries":0,"method":"execute","mandatory":null,"params":[{"code":true,"value":"remediateviaawscli()","param":null,"viewName":"command","name":"COMMANDS","type":"string","description":null}],"isEnabled":true,"numParallel":null}],"used_plugin":{"name":"CommandLine","version":"1.2.0"},"uuid":"6afdd407-d8ae-40ed-902c-84ec47f0d593","coordination":"each","numProcessParallel":null,"name":"Remediate via CLI","description":"S3 buckets to remediate\n","condition":"checkremediationviacli()","filterAgents":null,"postRun":"indexRemediate++;","preRun":null},{"flowControl":"each","actionsExecution":"series","correlateAgents":null,"mandatory":null,"actions":[{"retries":0,"mandatory":null,"isEnabled":true,"params":[{"_id":"605890bf257f080034066f8e","code":null,"value":"Slack Webhook","param":"6037e2b407d264003420c666","name":"webhookUrl"},{"_id":"605890bf257f080034066f8f","code":true,"value":"sendslackmessage()","param":"6037e2b407d264003420c667","name":"message"}],"name":"informsecurity","timeout":null,"method":"sendIncomingWebhook","numParallel":null}],"used_plugin":{"name":"Slack","version":"1.1.0"},"uuid":"00e3f4bf-8d71-4bcc-bc12-1d066ae79640","coordination":"each","numProcessParallel":null,"name":"Remediated","description":null,"condition":"indexSlack < bucketArr.length","filterAgents":null,"postRun":"indexSlack++;","preRun":null},{"flowControl":"each","actionsExecution":"series","correlateAgents":null,"mandatory":null,"actions":[{"name":"remediateviaobject","timeout":null,"retries":0,"method":"putBucketVersioning","mandatory":null,"params":[{"code":null,"value":"AWS Access Key","param":null,"viewName":"Access key","name":"AWS_ACCESS_KEY_ID","type":"vault","description":null},{"code":null,"value":"AWS Secret Key","param":null,"viewName":"Secret key","name":"AWS_SECRET_ACCESS_KEY","type":"vault","description":null},{"code":true,"value":"remediateviaobject()","param":null,"viewName":"Bucket name","name":"bucketName","type":"string","description":null},{"code":false,"value":"Enabled","param":null,"viewName":"Status","name":"status","type":"options","description":null},{"code":null,"value":"Enabled","param":null,"viewName":"MFA Delete","name":"mfaDelete","type":"options","description":null},{"code":true,"value":"getmfadevice()","param":null,"viewName":"MFA","name":"mfa","type":"string","description":null}],"isEnabled":true,"numParallel":null}],"used_plugin":{"name":"Amazon-aws-s3","version":"1.5.4"},"uuid":"d23a30c4-19ee-41cc-982f-916ec1571139","numProcessParallel":null,"name":"Remediate via Object","description":null,"condition":"checkremediationviaobject()","coordination":"each","filterAgents":null,"postRun":"indexRemediate++;","preRun":null},{"flowControl":"each","actionsExecution":"series","correlateAgents":null,"mandatory":null,"actions":[{"name":"sendmessageforignored","timeout":null,"retries":0,"method":"sendIncomingWebhook","mandatory":null,"params":[{"code":null,"value":"Slack Webhook","param":"605890bf257f080034066f97","viewName":"Webhook URL","name":"webhookUrl","type":"vault","description":null},{"code":true,"value":"sendslackmessageforignored()","param":"605890bf257f080034066f98","viewName":"Message (string, object)","name":"message","type":"string","description":null}],"isEnabled":true,"numParallel":null}],"used_plugin":{"name":"Slack","version":"1.1.0"},"uuid":"5a150d18-a9ac-4d09-9fbd-a182e20ed04c","coordination":"each","numProcessParallel":null,"name":"Ignored","description":"Inform about Ignored buckets.","condition":"checkforignoredslack()","filterAgents":null,"postRun":"indexIgnored++;","preRun":null}],"links":[{"uuid":"e0532683-d721-4b7d-b67c-b0151ab2289b","sourceId":"e561808e-b32b-4964-91e9-3151907d1f59","targetId":"6ec701d8-5bd5-47a2-afa4-134e6abb038b"},{"uuid":"c698e2ac-0eeb-43ad-a1a4-e9738e13e5de","sourceId":"6ec701d8-5bd5-47a2-afa4-134e6abb038b","targetId":"6afdd407-d8ae-40ed-902c-84ec47f0d593"},{"uuid":"ce7b8668-03fa-4e6a-b811-3924a9ad1734","sourceId":"6afdd407-d8ae-40ed-902c-84ec47f0d593","targetId":"6afdd407-d8ae-40ed-902c-84ec47f0d593"},{"uuid":"d32a867d-b504-4ea0-8343-2d4717aaaad5","sourceId":"6ec701d8-5bd5-47a2-afa4-134e6abb038b","targetId":"00e3f4bf-8d71-4bcc-bc12-1d066ae79640"},{"uuid":"ec0ca910-bd69-40d6-8ac3-a6c5b0231674","sourceId":"00e3f4bf-8d71-4bcc-bc12-1d066ae79640","targetId":"00e3f4bf-8d71-4bcc-bc12-1d066ae79640"},{"uuid":"86544743-bf1c-4a00-81f2-acdccd25203d","sourceId":"d23a30c4-19ee-41cc-982f-916ec1571139","targetId":"d23a30c4-19ee-41cc-982f-916ec1571139"},{"uuid":"c31ee622-a56f-40cc-bc5b-51763625de23","sourceId":"6ec701d8-5bd5-47a2-afa4-134e6abb038b","targetId":"d23a30c4-19ee-41cc-982f-916ec1571139"},{"uuid":"4a60e977-9120-4800-ad26-205a2f125a85","sourceId":"5a150d18-a9ac-4d09-9fbd-a182e20ed04c","targetId":"5a150d18-a9ac-4d09-9fbd-a182e20ed04c"},{"uuid":"0551d81d-7d55-402d-b7d9-1a1c5cd6a80b","sourceId":"00e3f4bf-8d71-4bcc-bc12-1d066ae79640","targetId":"5a150d18-a9ac-4d09-9fbd-a182e20ed04c"}],"content":"{\"cells\":[{\"type\":\"devs.PMStartPoint\",\"size\":{\"width\":40,\"height\":39},\"outPorts\":[\" \"],\"inPorts\":[],\"ports\":{\"groups\":{\"in\":{\"position\":{\"name\":\"left\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"left\",\"args\":{\"y\":10}}}},\"out\":{\"position\":{\"name\":\"right\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"right\",\"args\":{\"y\":10}}}}},\"items\":[{\"id\":\" \",\"group\":\"out\",\"attrs\":{\".port-label\":{\"text\":\" \"}}}]},\"position\":{\"x\":49,\"y\":42},\"angle\":0,\"id\":\"e561808e-b32b-4964-91e9-3151907d1f59\",\"z\":1,\"attrs\":{\"rect\":{\"fill\":\"#2d3236\"}}},{\"type\":\"devs.MyImageModel\",\"size\":{\"width\":100,\"height\":73},\"inPorts\":[\" \"],\"outPorts\":[\"  \"],\"ports\":{\"groups\":{\"in\":{\"position\":{\"name\":\"left\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"left\",\"args\":{\"y\":10}}}},\"out\":{\"position\":{\"name\":\"right\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"right\",\"args\":{\"y\":10}}}}},\"items\":[{\"id\":\" \",\"group\":\"in\",\"attrs\":{\".port-label\":{\"text\":\" \"}}},{\"id\":\"  \",\"group\":\"out\",\"attrs\":{\".port-label\":{\"text\":\"  \"}}}]},\"position\":{\"x\":199,\"y\":29},\"angle\":0,\"id\":\"6ec701d8-5bd5-47a2-afa4-134e6abb038b\",\"z\":2,\"attrs\":{\"rect\":{\"stroke-width\":1,\"fill\":\"#2d3236\"},\".label\":{\"text\":\"Get event details\"},\".p_id\":{\"text\":\"6023b2e264b1160034fd9b9f\"},\"image\":{\"xlink:href\":\"/plugins/lacework/lacework.png\",\"ref-y\":50},\"text\":{\"text\":\"Get event details\"}}},{\"type\":\"link\",\"source\":{\"id\":\"e561808e-b32b-4964-91e9-3151907d1f59\",\"port\":\" \"},\"target\":{\"id\":\"6ec701d8-5bd5-47a2-afa4-134e6abb038b\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"e0532683-d721-4b7d-b67c-b0151ab2289b\",\"z\":3,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}},{\"type\":\"devs.MyImageModel\",\"size\":{\"width\":100,\"height\":73},\"inPorts\":[\" \"],\"outPorts\":[\"  \"],\"ports\":{\"groups\":{\"in\":{\"position\":{\"name\":\"left\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"left\",\"args\":{\"y\":10}}}},\"out\":{\"position\":{\"name\":\"right\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"right\",\"args\":{\"y\":10}}}}},\"items\":[{\"id\":\" \",\"group\":\"in\",\"attrs\":{\".port-label\":{\"text\":\" \"}}},{\"id\":\"  \",\"group\":\"out\",\"attrs\":{\".port-label\":{\"text\":\"  \"}}}]},\"position\":{\"x\":385,\"y\":-187},\"angle\":0,\"id\":\"6afdd407-d8ae-40ed-902c-84ec47f0d593\",\"z\":4,\"attrs\":{\"rect\":{\"stroke-width\":1,\"fill\":\"#2d3236\"},\".label\":{\"text\":\"Remediate via CLI\"},\".p_id\":{\"text\":\"5f92a2f3da3961001ab1a0c4\"},\"image\":{\"xlink:href\":\"/plugins/CommandLine/CommandLine.png\",\"ref-y\":50},\"text\":{\"text\":\"Remediate via CLI\"}}},{\"type\":\"link\",\"source\":{\"id\":\"6ec701d8-5bd5-47a2-afa4-134e6abb038b\",\"port\":\"  \"},\"target\":{\"id\":\"6afdd407-d8ae-40ed-902c-84ec47f0d593\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"c698e2ac-0eeb-43ad-a1a4-e9738e13e5de\",\"z\":5,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}},{\"type\":\"link\",\"source\":{\"id\":\"6afdd407-d8ae-40ed-902c-84ec47f0d593\",\"port\":\"  \"},\"target\":{\"id\":\"6afdd407-d8ae-40ed-902c-84ec47f0d593\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"ce7b8668-03fa-4e6a-b811-3924a9ad1734\",\"z\":6,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}},{\"type\":\"devs.MyImageModel\",\"size\":{\"width\":100,\"height\":73},\"inPorts\":[\" \"],\"outPorts\":[\"  \"],\"ports\":{\"groups\":{\"in\":{\"position\":{\"name\":\"left\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"left\",\"args\":{\"y\":10}}}},\"out\":{\"position\":{\"name\":\"right\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"right\",\"args\":{\"y\":10}}}}},\"items\":[{\"id\":\" \",\"group\":\"in\",\"attrs\":{\".port-label\":{\"text\":\" \"}}},{\"id\":\"  \",\"group\":\"out\",\"attrs\":{\".port-label\":{\"text\":\"  \"}}}]},\"position\":{\"x\":388,\"y\":261},\"angle\":0,\"id\":\"00e3f4bf-8d71-4bcc-bc12-1d066ae79640\",\"z\":7,\"attrs\":{\"rect\":{\"stroke-width\":1,\"fill\":\"#2d3236\"},\".label\":{\"text\":\"Remediated\"},\".p_id\":{\"text\":\"5f92a31fda3961001ab1a1a6\"},\"image\":{\"xlink:href\":\"/plugins/Slack/Slack_Icon.png\",\"ref-y\":50},\"text\":{\"text\":\"Remediated\"}}},{\"type\":\"link\",\"source\":{\"id\":\"6ec701d8-5bd5-47a2-afa4-134e6abb038b\",\"port\":\"  \"},\"target\":{\"id\":\"00e3f4bf-8d71-4bcc-bc12-1d066ae79640\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"d32a867d-b504-4ea0-8343-2d4717aaaad5\",\"z\":8,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}},{\"type\":\"link\",\"source\":{\"id\":\"00e3f4bf-8d71-4bcc-bc12-1d066ae79640\",\"port\":\"  \"},\"target\":{\"id\":\"00e3f4bf-8d71-4bcc-bc12-1d066ae79640\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"ec0ca910-bd69-40d6-8ac3-a6c5b0231674\",\"z\":9,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}},{\"type\":\"devs.MyImageModel\",\"size\":{\"width\":100,\"height\":73},\"inPorts\":[\" \"],\"outPorts\":[\"  \"],\"ports\":{\"groups\":{\"in\":{\"position\":{\"name\":\"left\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"left\",\"args\":{\"y\":10}}}},\"out\":{\"position\":{\"name\":\"right\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"right\",\"args\":{\"y\":10}}}}},\"items\":[{\"id\":\" \",\"group\":\"in\",\"attrs\":{\".port-label\":{\"text\":\" \"}}},{\"id\":\"  \",\"group\":\"out\",\"attrs\":{\".port-label\":{\"text\":\"  \"}}}]},\"position\":{\"x\":455,\"y\":30},\"angle\":0,\"id\":\"d23a30c4-19ee-41cc-982f-916ec1571139\",\"z\":10,\"attrs\":{\"rect\":{\"stroke-width\":1,\"fill\":\"#2d3236\"},\".label\":{\"text\":\"Remediate via Object\"},\".p_id\":{\"text\":\"6047970a887b2000347ea8bd\"},\"image\":{\"xlink:href\":\"/plugins/Amazon-aws-s3/logo.png\",\"ref-y\":50},\"text\":{\"text\":\"Remediate via Object\"}}},{\"type\":\"link\",\"source\":{\"id\":\"d23a30c4-19ee-41cc-982f-916ec1571139\",\"port\":\"  \"},\"target\":{\"id\":\"d23a30c4-19ee-41cc-982f-916ec1571139\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"86544743-bf1c-4a00-81f2-acdccd25203d\",\"z\":11,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}},{\"type\":\"link\",\"source\":{\"id\":\"6ec701d8-5bd5-47a2-afa4-134e6abb038b\",\"port\":\"  \"},\"target\":{\"id\":\"d23a30c4-19ee-41cc-982f-916ec1571139\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"c31ee622-a56f-40cc-bc5b-51763625de23\",\"z\":12,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}},{\"type\":\"devs.MyImageModel\",\"size\":{\"width\":100,\"height\":73},\"inPorts\":[\" \"],\"outPorts\":[\"  \"],\"ports\":{\"groups\":{\"in\":{\"position\":{\"name\":\"left\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"left\",\"args\":{\"y\":10}}}},\"out\":{\"position\":{\"name\":\"right\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"right\",\"args\":{\"y\":10}}}}},\"items\":[{\"id\":\" \",\"group\":\"in\",\"attrs\":{\".port-label\":{\"text\":\" \"}}},{\"id\":\"  \",\"group\":\"out\",\"attrs\":{\".port-label\":{\"text\":\"  \"}}}]},\"position\":{\"x\":682,\"y\":264},\"angle\":0,\"id\":\"5a150d18-a9ac-4d09-9fbd-a182e20ed04c\",\"z\":13,\"attrs\":{\"rect\":{\"stroke-width\":1,\"fill\":\"#2d3236\"},\".label\":{\"text\":\"Ignored\"},\".p_id\":{\"text\":\"5f92a31fda3961001ab1a1a6\"},\"image\":{\"xlink:href\":\"/plugins/Slack/Slack_Icon.png\",\"ref-y\":50},\"text\":{\"text\":\"Ignored\"}}},{\"type\":\"link\",\"source\":{\"id\":\"5a150d18-a9ac-4d09-9fbd-a182e20ed04c\",\"port\":\"  \"},\"target\":{\"id\":\"5a150d18-a9ac-4d09-9fbd-a182e20ed04c\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"4a60e977-9120-4800-ad26-205a2f125a85\",\"z\":14,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}},{\"type\":\"link\",\"source\":{\"id\":\"00e3f4bf-8d71-4bcc-bc12-1d066ae79640\",\"port\":\"  \"},\"target\":{\"id\":\"5a150d18-a9ac-4d09-9fbd-a182e20ed04c\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"0551d81d-7d55-402d-b7d9-1a1c5cd6a80b\",\"z\":15,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}}]}","used_plugins":[{"name":"lacework","version":"1.0.0"},{"name":"CommandLine","version":"1.2.0"},{"name":"Slack","version":"1.1.0"},{"name":"Amazon-aws-s3","version":"1.5.4"},{"name":"Slack","version":"1.1.0"}],"__v":0,"code":"var bucketArr = []; // Array of S3 Buckets that will be filled with the resource information from the event.\nvar indexRemediate = 0; // Index for the S3 Bucket Remediate of the Map\nvar indexSlack = 0; // Index of the Slack Loop to send out information about the S3 Bucket remediation.\nvar bucketIgnoredArr = []; // Array of S3 Buckets that are violating but will be ignored.\nvar indexIgnored = 0; //Index of the S3 Buckets that are in the event but will be ignored.\n\nlet payload = trigger.payload; // The Payload that was send by the Webhook Trigger. Information about the Payload is available at https://support.lacework.com/hc/en-us/articles/360034367393-Webhook\n\nfunction checkconfiguration()  { // Function to check if CLI and Object remediation is enabled.\n    if (configuration.dotheremediationviacli == \"true\" && configuration.dotheremediationviaobject == \"true\") {\n        return 0;\n    }\n    else {\n        return 1;\n    }\n}\n\nfunction geteventid() { // Function to get the Event ID from the Webhook Payload.\n    return `${payload.event_id}`;\n}\n\nfunction createBucketList() { // Function to build the S3 Bucket List that will be used to Remediate.\n    let p = configuration.eventuuid;\n    let laceworkAPIResult = getAction(p);\n    let resourcesArr = laceworkAPIResult.result.result.data[0].ENTITY_MAP.Resource;\n    for (let i = 0; i < resourcesArr.length; i++) {\n        if (!configuration.bucketIgnoreList.includes(resourcesArr[i].VALUE)) { // The S3 Bucket of the Event will be checked against the configuration list of to ignore S3 buckets.\n            bucketArr.push (resourcesArr[i].VALUE); // If the bucket is not on the list it will be pushed into the array.\n        }\n        else {\n            bucketIgnoredArr.push (resourcesArr[i].VALUE); // If the bucket is on the list and violating the policy it will be pushed into the second bucket list.\n        }\n    }\n}\n\nfunction printBucketName() { // Function to print the S3 buckets that will be remediated.\n    let bucket = bucketArr[indexRemediate]\n    let arr = bucket.split(\":::\")\n    return `echo Compliance Violation ${configuration.policyID} for the S3 bucket ${arr[arr.length-1]}`;\n}\n\nfunction remediateviaawscli() { // Remediate the S3 buckets via the CLI.\n    let bucket = bucketArr[indexRemediate];\n    let arr = bucket.split(\":::\");\n    return `aws s3api put-bucket-versioning --bucket ${arr[arr.length-1]} --versioning-configuration Status=Enabled,MFADelete=Enabled --mfa \"${configuration.mfadevice}\"`; //Using the setting to configure Versioning and MFA at the same time.\n}\n\n\nfunction remediateviaobject() { // Remediate the S3 buckets via the object.\n    let bucket = bucketArr[indexRemediate];\n    let arr = bucket.split(\":::\");\n    return `${arr[arr.length-1]}`;\n}\n\nfunction getmfadevice() {\n    return `${configuration.mfadevice}`;\n}\n\nfunction sendslackmessage() { // Function to send out a slack message for every S3 bucket that will be remediated.\n    let bucket = bucketArr[indexSlack];\n    let arr = bucket.split(\":::\");\n    let event_link = payload.event_link;\n    if (configuration.dotheremediationviacli == \"true\") {\n        return `Compliance Violation ${configuration.policyID} The following S3 bucket is auto remediated back to ${configuration.violationdescription}: ${arr[arr.length-1]}. Executing CLI command aws s3api put-bucket-acl --bucket ${arr[arr.length-1]} --acl private. More information about the event is available at ${event_link}`;\n    }\n    else if (configuration.dotheremediationviaobject == \"true\") {\n        return `Compliance Violation ${configuration.policyID} The following S3 bucket is auto remediated back to ${configuration.violationdescription}: ${arr[arr.length-1]}. Using the Kaholo S3 object to do the remediation. More information about the event is available at ${event_link}`;\n    }\n    else {\n        return `Compliance Violation ${configuration.policyID}. Auto Remediation is diabled! The following S3 bucket would be auto remediated back to ${configuration.violationdescription}: ${arr[arr.length-1]}. Would execute CLI command aws s3api put-bucket-acl --bucket ${arr[arr.length-1]} --acl private. More information about the event is available at ${event_link}`;   \n    }\n}\n\nfunction sendslackmessageforignored() { // Function to send out a slack message for every S3 bucket that will be ignored but is violating the policy.\n    let bucket = bucketIgnoredArr[indexIgnored];\n    let arr = bucket.split(\":::\");\n    let event_link = payload.event_link;\n    return `Compliance Violation ${configuration.policyID} The following S3 bucket is NOT remediated back to ${configuration.violationdescription}: ${arr[arr.length-1]}. It is ignored by the configuration of the Map. We recommend using tags in AWS to suppress this S3 bucket from triggering alerts in Lacework. More information about the event is available at ${event_link}`;    \n}\n\nfunction checkremediationviacli() //Check if the Remedation should be done via the CLI?\n{\n    if (configuration.dotheremediationviacli == \"true\") {\n        if (indexRemediate < bucketArr.length) {\n            return 1;\n        }\n        else {\n            return 0;\n        }\n    }\n    else {\n        return 0;\n    }\n}\n\nfunction checkremediationviaobject() //Check if the Remedation should be done via the Object?\n{\n    if (configuration.dotheremediationviaobject == \"true\") {\n        if (indexRemediate < bucketArr.length) {\n            return 1;\n        }\n        else {\n            return 0;\n        }\n    }\n    else {\n        return 0;\n    }\n}\n\nfunction checkforignoredslack() { //Check if you want to also see the ignored buckets via the slack messages.\n    if (indexSlack == bucketArr.length && indexIgnored < bucketIgnoredArr.length && configuration.sendslackmessagesforignored == \"true\") {\n        return 1;\n    }\n    else {\n         return 0;\n    }\n}\n\nfunction getAction(pId) {  // Help function to get the return value of the event.\n   let p = getProcessById(pId)//Get the process. \n   if(!p ||!p.length)return; \n   p = p[p.length-1].actions; //Get all actions \n   let action = p[Object.keys(p)[0]];//get the needed action \n   return action \n}"}